# WebDaYi (網頁大易輸入法)

> **Language / 語言**: [English](README.en.md) | [正體中文](README.md)

> 輕量、透明、網頁優先的大易中文輸入法引擎

[![Status](https://img.shields.io/badge/status-MVP%201%20v7%20Complete%20%2B%20Converter%20v2-brightgreen)]()
[![Phase](https://img.shields.io/badge/phase-MVP%201.0%20v7-blue)]()
[![Tests](https://img.shields.io/badge/tests-56%2F56%20passing-brightgreen)]()
[![License](https://img.shields.io/badge/license-open%20source-green)]()

## 🎉 線上展示

**[立即試用 WebDaYi MVP1 v7 →](https://clarencechien.github.io/webdayi/)** (GitHub Pages)

在瀏覽器中體驗核心大易輸入引擎，具備進階功能：
- 🚀 **自動選字**：輸入2碼 + 第3碼 = 自動選取第一候選字（加速打字！）
- 📄 **翻頁功能**：當候選字超過60個時，按 `=` 鍵循環翻頁
- ⌨️ **智慧選字**：使用 Space/' /[/]/- /\ 選取候選字（0-9 現在是字碼的一部分！）
- ⌫ **智慧倒退**：先刪除輸入，再刪除輸出緩衝區（自然的復原流程！）
- 🎯 **專注模式**：切換至極簡介面（隱藏干擾，專注輸入！）
- 🧠 **使用者個人化**：輸入法會學習您的偏好！(MVP1.7-1.9) **[Bug 已修復！]**
- 📱 **觸控友善**：點擊選字 + 上下頁按鈕！(MVP1.10)

## 專案概述

**WebDaYi** 以簡單、現代的 JavaScript 解決方案取代複雜、龐大的輸入法框架。不需要與設定檔搏鬥，您將獲得一個透明的輸入法：

- 🎯 **開箱即用**：無需任何設定
- 🪶 **輕量級**：純 JavaScript，無笨重框架
- 🔍 **透明**：每一行程式碼都可讀且可修改
- 🌐 **瀏覽器優先**：為 Gmail、Google Docs、Notion 等網頁應用程式最佳化
- 🔄 **智慧**：採用 Rime 優秀的大易字典資料

## 專案狀態

**目前階段**：✅ MVP 1.0 v7 完成！
**完成度**：~48%（Phase 0 與 MVP 1 v7 完成，MVP 2a 下一步）

```
┌──────────────────────────────────────────────────────────┐
│ Phase 0: 資料處理管線       [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│ Phase 1: MVP 1.0 v7        [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 選字鍵修正             [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 翻頁功能               [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 自動選字               [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 智慧倒退               [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 輸入模式切換           [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   ├─ 使用者個人化           [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│   └─ 觸控友善 UX            [▓▓▓▓▓▓▓▓▓▓▓▓] 100% ✅    │
│ Phase 2: MVP 2a            [░░░░░░░░░░░░]   0% ⏳    │
└──────────────────────────────────────────────────────────┘
```

**最新成就**：MVP 1.0 v7 具備觸控友善 UX + 關鍵 bug 修復（56/56 測試通過）
- ✅ 觸控友善 UX 已實作（MVP1.10）
- 🐛 已修復：自動選字現在會遵循使用者偏好（MVP1.9 bug 修復）
- ✅ **頻率轉換器 v2**：使用台灣教育部 2000 高頻字資料進行智慧排序
**下個里程碑**：開始 MVP 2a（瀏覽器外掛）實作

## 💡 核心特色：頻率導向的智慧排序

WebDaYi 使用真實世界的字元使用頻率資料，而非任意排序：

### 🎯 轉換器 v2：頻率排序系統

我們的**增強資料管線**整合了台灣教育部的 2000 個最常用正體中文字資料：

- **真實資料來源**：台灣教育部高頻字排名（教育部）
- **智慧排序**：候選字依實際使用頻率排序
- **測試驗證**：21 個自動化測試確保正確性
- **向下相容**：沒有頻率資料時退回基礎版本

**範例**：對於字碼 `4jp`：
```json
{
  "4jp": [
    { "char": "易", "freq": 9992 },  // 排名 9（超高頻）
    { "char": "義", "freq": 9544 },  // 排名 ~500（高頻）
    { "char": "蜴", "freq": 1000 }   // 不在排名中（預設）
  ]
}
```

這確保最常用的字元優先出現，使輸入更快速、更直覺。

**技術細節**：
- 線性映射：排名 1 → 頻率 10000，排名 2000 → 頻率 8000
- 未排名字元預設頻率：1000
- 採用 TDD（測試驅動開發）開發

## 快速開始

### 立即試用（線上展示）

**[啟動 WebDaYi MVP1 v7 →](https://clarencechien.github.io/webdayi/)**

無需安裝！只要開啟連結並開始輸入：
- 試試 `v` → 大, 夫, 禾
- 試試 `a` → 人, 入
- 試試 `ux` → 61 個候選字，按 `=` 或使用按鈕翻頁
- 按 `Space`（第1個）、`'`（第2個）、`[`（第3個）、`]`（第4個）、`-`（第5個）、`\`（第6個）選字
- **或直接點擊**候選字選取（觸控友善！）
- 輸入 2 碼後繼續 → 自動選取第一候選字！
- 按 `Backspace` 復原（刪除輸入，然後是輸出緩衝區）
- 切換至專注模式（右上角）取得極簡介面
- 選取非預設候選字 → **輸入法會學習您的偏好並在自動選字時使用！**[Bug 已修復 ✅]
- **新功能**：使用 ◀ **上一頁** / **下一頁** ▶ 按鈕在手機/平板上輕鬆翻頁！
- 完成後點擊「複製」

### 給開發者

```bash
# 複製儲存庫
git clone https://github.com/clarencechien/webdayi.git
cd webdayi

# 執行測試（全部 35 個測試應通過）
cd mvp1
node test-node-v6.js  # 使用者個人化測試 (19/19)
node test-node-v7.js  # 自動選字 bug 修復測試 (16/16)

# 在瀏覽器中本地開啟
open index.html
# 或使用本地伺服器：
python3 -m http.server 8000
# 造訪：http://localhost:8000

# 資料處理管線：重新產生資料庫（如有需要）
cd ../converter
node convert-v2.js  # 使用頻率資料建立 mvp1/dayi_db.json（推薦）
# 或使用 node convert.js（基礎版本）
```

### 未來功能（MVP 2a - 瀏覽器擴充套件）

當 MVP 2a 完成時：
1. 從 Chrome 線上應用程式商店安裝擴充套件
2. 在任何網頁應用程式（Gmail、Docs 等）開始輸入
3. 原生輸入體驗！

## 文件

### 核心文件

| 文件 | 用途 | 受眾 |
|----------|---------|----------|
| [PRD.md](PRD.md) | 產品需求與規格 | 產品、工程 |
| [CLAUDE.md](CLAUDE.md) | AI 助手技術指南 | AI、工程 |

### Memory Bank（詳細文件）

`memory-bank/` 目錄包含完整的專案文件：

| 檔案 | 說明 |
|------|-------------|
| [projectbrief.md](memory-bank/projectbrief.md) | 使命、目標、範圍與架構 |
| [productContext.md](memory-bank/productContext.md) | 為何存在、解決的問題、UX 願景 |
| [systemPatterns.md](memory-bank/systemPatterns.md) | 架構、設計模式、技術決策 |
| [techContext.md](memory-bank/techContext.md) | 技術堆疊、設定、API、相依性 |
| [activeContext.md](memory-bank/activeContext.md) | 目前工作、下一步、活躍決策 |
| [progress.md](memory-bank/progress.md) | 狀態追蹤器、里程碑、完成率 |

**💡 專案新手？** 從 [projectbrief.md](memory-bank/projectbrief.md) 開始，然後是 [activeContext.md](memory-bank/activeContext.md)

## 架構

### 大架構圖

```
┌─────────────────────────────────────────────────────────┐
│  Rime 字典（YAML）                                      │
│  dayi.dict.yaml                                         │
└─────────────┬───────────────────────────────────────────┘
              │
              │ Phase 0：離線轉換
              ▼
┌─────────────────────────────────────────────────────────┐
│  WebDaYi 資料庫（JSON）                                 │
│  dayi_db.json - O(1) 可查詢                             │
└─────────┬───────────────────────────┬───────────────────┘
          │                           │
          │ Phase 1                   │ Phase 2
          ▼                           ▼
┌───────────────────────┐   ┌───────────────────────────┐
│  靜態網頁             │   │  Chrome 擴充套件          │
│  （驗證）             │   │  （正式版）               │
│                       │   │                           │
│  • 輸入框             │   │  • 背景腳本               │
│  • 候選字顯示         │   │  • 內容腳本               │
│  • 剪貼簿輸出         │   │  • 即時注入               │
└───────────────────────┘   └───────────────────────────┘
```

### 專案結構

```
webdayi/
├── converter/                   # Phase 0：資料處理管線
│   ├── convert.js              # YAML → JSON 轉換器（基礎版本）
│   ├── convert-v2.js           # 增強轉換器（頻率排序）✅
│   ├── convert-v2-lib.js       # 轉換器函式庫
│   ├── convert-v2.test.js      # 轉換器測試套件（21 個測試）
│   ├── DESIGN-v2.md            # 轉換器 v2 設計文件
│   ├── README.md               # 轉換器文件
│   ├── raw_data/
│   │   ├── dayi.dict.yaml      # Rime 大易字典來源
│   │   └── freq.yaml           # 字元頻率資料（2000 字，台灣教育部）
│   └── test-data/
│       └── freq-sample.yaml    # 測試頻率資料（20 字範例）
├── mvp1/                       # Phase 1：靜態網頁
│   ├── index.html              # 主要使用者介面
│   ├── core_logic.js           # 核心查詢引擎（v7）
│   ├── style.css               # 樣式表
│   ├── dayi_db.json            # 產生的資料庫（頻率排序）
│   ├── README.md               # MVP1 文件（正體中文）
│   ├── README.en.md            # MVP1 文件（英文）
│   ├── test.html               # 瀏覽器測試執行器
│   ├── test-node.js            # Node.js 測試執行器（v1）
│   ├── test-node-v2.js         # 選字鍵測試（v2）
│   ├── test-node-v3.js         # 翻頁與自動選字測試（v3）
│   ├── test-node-v4.js         # 智慧倒退測試（v4）
│   ├── test-node-v5.js         # 輸入模式切換測試（v5）
│   ├── test-node-v6.js         # 使用者個人化測試（19 個測試）
│   └── test-node-v7.js         # 自動選字 bug 修復測試（16 個測試）
├── mvp2a-plugin/               # Phase 2：瀏覽器擴充套件（規劃中）
│   ├── manifest.json           # Chrome 擴充套件設定
│   ├── background.js           # Service Worker
│   └── content.js              # DOM 注入
└── memory-bank/                # 專案文件
    ├── projectbrief.md         # 專案簡介
    ├── productContext.md       # 產品脈絡
    ├── systemPatterns.md       # 系統模式
    ├── techContext.md          # 技術脈絡
    ├── activeContext.md        # 活躍脈絡
    └── progress.md             # 進度追蹤
```

## 功能

### MVP 1.0 v6：核心引擎 ✅ 完成

**基本功能：**
- ✅ 將大易字典載入記憶體（Map 資料結構，1,584 個字碼）
- ✅ 依字碼查詢候選字（例如：「4jp」→「易」、「義」）
- ✅ 依頻率排序（最常用的優先）
- ✅ 使用智慧鍵選字（Space/' /[/]/- /\）
  - **重要**：0-9 現在是字碼的一部分（例如：t0、t1），**不是**選字鍵
- ✅ 複製組合文字至剪貼簿

**進階功能（v3）：**
- ✅ **翻頁系統**：使用 `=` 鍵循環翻頁
  - 處理超過 60 個候選字的字碼（例如：ux：61 個候選字 → 11 頁）
  - 視覺指示器：「第 1/3 頁 = 換頁」
  - 最後一頁後循環回第一頁
- ✅ **第 3 字元自動選字**：加速打字
  - 輸入 2 碼 → 第 3 碼 → 第一候選字自動選取
  - 新字元成為新的輸入字碼
  - 不會在選字/翻頁鍵上觸發

**進階功能（v4）：**
- ✅ **智慧倒退**：專業輸入法風格的復原行為
  - 輸入有 2 碼時倒退 → 1 碼（**不會**觸發自動選字）
  - 輸入有 1 碼時倒退 → 空輸入
  - 輸入為空時倒退 → 從輸出緩衝區刪除最後一個字元
  - 連續倒退 → 持續從輸出刪除直到清空
  - 提供自然的修正與復原流程

**進階功能（v5）：**
- ✅ **輸入模式切換**：在一般與專注模式之間切換
  - 一般模式：完整 UI，含說明與品牌
  - 專注模式：極簡 UI（僅輸入/候選字/輸出）
  - 切換按鈕始終可見（右上角）
  - 偏好設定儲存至 localStorage（跨工作階段保留）
  - 專注模式的視覺指示器

**進階功能（v6）：**
- ✅ **使用者個人化**：輸入法學習您的字元偏好
  - **MVP1.7**：頁面載入時從 localStorage 載入個人記錄
  - **MVP1.8**：選取非預設候選字時儲存個人偏好
  - **MVP1.9**：在候選字排序中優先使用者偏好
  - 範例：字碼 `4jp` 偏好「義」而非「易」→「義」下次出現在第一位
  - 偏好設定跨工作階段保留
  - 與翻頁和自動選字無縫整合
  - 專業的自適應輸入法行為
  - **🐛 Bug 已修復**：自動選字現在正確使用使用者偏好（先前使用預設順序）

**進階功能（v7）：**
- ✅ **觸控友善 UX**：為手機和平板最佳化的互動
  - **MVP1.10**：點擊選取候選字 + 上下頁按鈕
  - 點擊任何候選字項目即可選取（無需鍵盤）
  - 視覺化 ◀ **上一頁** / **下一頁** ▶ 按鈕，方便翻頁
  - 觸控最佳化按鈕大小（最小 44px 觸控目標）
  - 懸停和活動狀態，提供清晰的視覺回饋
  - 維持鍵盤無障礙功能（可在聚焦項目上使用 Enter/Space）
  - 完美適合觸控裝置和軌跡板使用者

**目標使用者**：開發者（用於驗證）與進階使用者
**輸出方法**：複製/貼上
**測試涵蓋率**：35/35 測試通過，採用 TDD（19 個個人化 + 16 個 bug 修復測試）

### MVP 2a：瀏覽器外掛（規劃中）

- ✅ Chrome 擴充套件（Manifest V3）
- ✅ 攔截網頁中的按鍵
- ✅ 在游標位置動態顯示候選字 UI
- ✅ 即時文字注入（無需複製/貼上）
- ✅ 適用於 Gmail、Google Docs、Notion

**目標使用者**：終端使用者
**輸出方法**：原生打字體驗

### 未來：MVP 2a+（路線圖）

- 🔮 雲端同步（透過 chrome.storage.sync 同步個人字典）
- 🔮 情境感知（針對 github.com 與 gmail.com 提供不同建議）
- 🔮 N-gram 學習（智慧詞組完成）
- 🔮 手動字典編輯

## 技術堆疊

- **語言**：JavaScript（ES6+）
- **執行環境**：Chrome 88+
- **擴充套件**：Manifest V3
- **資料**：JSON（來自 Rime YAML）
- **相依性**：零（正式版）、js-yaml（開發版）

**理念**：無框架，最大透明度

## 開發

### 先決條件

- Node.js ≥ 18
- Chrome 瀏覽器 ≥ 88
- JavaScript 基礎知識

### 目前階段：資料處理管線

```bash
# 1. 設定轉換器
mkdir -p converter/raw_data
mv dayi2dict.yaml converter/raw_data/dayi.dict.yaml

# 2. 安裝相依性
cd converter
npm install js-yaml

# 3. 執行轉換器（待實作）
node convert.js

# 4. 驗證輸出
cat ../mvp1/dayi_db.json | jq '."4jp"'
# 預期：[{"char":"易","freq":80}, ...]
```

### 測試

**測試涵蓋率**：✅ 56/56 測試通過（採用 TDD）

```bash
# 轉換器測試（21 個測試）
cd converter
node convert-v2.test.js
# ✓ 頻率解析（3 個測試）
# ✓ 頻率計算（5 個測試）
# ✓ 大易字典解析（3 個測試）
# ✓ 候選字豐富化（3 個測試）
# ✓ 整合測試（3 個測試）
# ✓ 邊界測試（4 個測試）

# MVP1 測試（35 個測試）
cd mvp1
node test-node-v6.js  # 使用者個人化（19 個測試）
node test-node-v7.js  # 自動選字 bug 修復（16 個測試）

# 瀏覽器手動測試
open mvp1/index.html
# 或執行測試套件：
open mvp1/test.html

# 測試擴充套件（Phase 2 - 規劃中）
# chrome://extensions → 開發人員模式 → 載入未封裝項目
```

**測試詳情**：
- **Phase 0（轉換器）**：21 個自動化測試，涵蓋頻率解析、計算與資料庫建立
- **Phase 1（MVP1）**：35 個自動化測試，涵蓋個人化、自動選字與 bug 修復
- **總計**：56 個測試，100% 通過率

## 貢獻

**目前狀態**：個人開發專案（學習/驗證階段）

一旦 MVP 2a 驗證完成，歡迎貢獻：
- Firefox 擴充套件移植
- 額外語言模型
- UI/UX 改進
- 文件

## 路線圖

| 里程碑 | 目標日期 | 狀態 |
|-----------|-------------|--------|
| ✅ 專案初始化 | 2025-11-06 | 完成 |
| ✅ Phase 0：資料處理管線（v1） | 2025-11-06 | 完成 |
| ✅ Phase 0：增強轉換器（v2，頻率排序） | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v1：核心引擎 | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v2：選字鍵修正 | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v3：翻頁與自動選字 | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v4：智慧倒退 UX | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v5：輸入模式切換 | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v6：使用者個人化 | 2025-11-06 | 完成 |
| ✅ MVP 1.0 v7：觸控友善 UX + Bug 修復 | 2025-11-06 | 完成 |
| ⏳ MVP 2a：瀏覽器外掛 | 2025-11-20 | 規劃中 |
| ⏳ 公開發布（Chrome 線上應用程式商店） | 2025-11-25 | 規劃中 |
| 📋 MVP 2a+：進階功能 | 2025-12-15 | 未來 |

## 理念

> **寄生於資料，創新於體驗**

我們不重建大易字典——我們採用 Rime 優秀的開源成果。我們的創新在於：

- **可及性**：網頁優先，在您打字的地方運作
- **透明度**：可讀、可修改的程式碼
- **可擴展性**：易於新增學習功能
- **無縫性**：瀏覽器原生體驗

## 授權

開源（授權待定 - 目前為開發階段）

## 致謝

- **Rime 專案**：高品質大易字典資料來源
- **大易輸入法**：經典中文輸入系統
- **開源社群**：靈感與工具

## 聯絡

- **問題回報**：[GitHub Issues](../../issues)（公開時）
- **討論**：[GitHub Discussions](../../discussions)（公開時）

---

**最後更新**：2025-11-06
**狀態**：MVP 1.0 v7 完成（含頻率轉換器 v2）
**版本**：1.0.7-alpha（MVP1 v7 with touch-friendly UX + Converter v2 with frequency-based ranking）
