<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebDaYi (網頁大易輸入法) - MVP 1.0</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Mode Toggle Button (Fixed Position) -->
  <button id="mode-toggle-btn" class="mode-toggle" aria-label="切換至專注模式">
    切換至專注模式
  </button>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>WebDaYi <span class="chinese">網頁大易輸入法</span></h1>
      <p class="subtitle">MVP 1.0 - Core Engine Validation</p>
    </header>

    <!-- Instructions -->
    <section class="instructions">
      <h2>使用說明 (Instructions)</h2>
      <ol>
        <li>在「輸入碼」框中輸入大易碼（包含 0-9, a-z 等字碼）</li>
        <li>候選字會即時顯示在下方</li>
        <li>使用快速選字鍵：
          <ul>
            <li><kbd>Space</kbd> 第 1 個字（最快！）</li>
            <li><kbd>'</kbd> 第 2 個字</li>
            <li><kbd>[</kbd> 第 3 個字</li>
            <li><kbd>]</kbd> 第 4 個字</li>
            <li><kbd>-</kbd> 第 5 個字</li>
            <li><kbd>\</kbd> 第 6 個字</li>
          </ul>
        </li>
        <li>選中的字會出現在「輸出緩衝區」</li>
        <li>組完句子後，點擊「複製」按鈕</li>
        <li>貼到其他應用程式使用</li>
      </ol>
      <div class="note">
        <strong>新功能：</strong>
        <ul>
          <li><strong>自動選字：</strong>輸入兩碼後，繼續打第三碼會自動選擇第一個候選字（加速打字速度）</li>
          <li><strong>換頁功能：</strong>當候選字超過 6 個時，按 <kbd>=</kbd> 可循環切換頁面</li>
          <li><strong>智能 Backspace：</strong>按 <kbd>Backspace</kbd> 會依序刪除輸入碼，輸入碼清空後會刪除輸出緩衝區的最後一個字，連續按可一路清空</li>
          <li><strong>個人化學習（v6 最新！）：</strong>輸入法會記住你的選字習慣！當你選擇非預設候選字時（例如選了第 2 個字），下次輸入相同字碼時，你偏好的字會自動排到第一位。偏好設定會自動儲存在瀏覽器中，下次開啟時自動載入</li>
          <li><strong>注意：</strong>0-9 是字碼的一部分（如 t0, t1），不再用於選字</li>
        </ul>
      </div>
    </section>

    <!-- Input Section -->
    <section class="input-section">
      <div class="input-group">
        <label for="input-box">
          輸入碼 (Input Code)
          <span class="hint">Type Dàyì code here</span>
        </label>
        <input
          type="text"
          id="input-box"
          class="input-box"
          placeholder="輸入大易碼..."
          autocomplete="off"
          spellcheck="false"
        />
      </div>

      <!-- Candidate Area -->
      <div class="candidate-section">
        <div class="candidate-header">
          候選字 (Candidates)
          <span class="hint">Press Space/' /[/]/- /\ to select, = to page</span>
        </div>
        <div id="candidate-area" class="candidate-area">
          <div class="no-candidates">請輸入大易碼</div>
        </div>
      </div>
    </section>

    <!-- Output Section -->
    <section class="output-section">
      <div class="output-group">
        <label for="output-buffer">
          輸出緩衝區 (Output Buffer)
          <span class="hint">Composed text appears here</span>
        </label>
        <textarea
          id="output-buffer"
          class="output-buffer"
          placeholder="組好的文字會出現在這裡..."
          rows="6"
        ></textarea>
      </div>

      <button id="copy-button" class="copy-button">
        📋 複製到剪貼簿 (Copy to Clipboard)
      </button>
    </section>

    <!-- Debug Info -->
    <section class="debug-section">
      <details>
        <summary>Debug Information</summary>
        <div id="debug-info" class="debug-info">
          <p>Database loading...</p>
        </div>
      </details>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p>
        WebDaYi MVP 1.0 - Core Engine Validation Tool
        <br>
        <small>
          Data source: <a href="https://github.com/rime/rime-dayi" target="_blank">Rime Dàyì Dictionary</a>
        </small>
      </p>
    </footer>
  </div>

  <!-- Core Logic -->
  <script src="core_logic.js"></script>

  <!-- Update debug info after loading -->
  <script>
    // Wait for database to load and update debug info
    setTimeout(() => {
      const debugInfo = document.getElementById('debug-info');
      if (debugInfo && dayiMap) {
        debugInfo.innerHTML = `
          <p><strong>Database Status:</strong> ✓ Loaded</p>
          <p><strong>Total Codes:</strong> ${dayiMap.size.toLocaleString()}</p>
          <p><strong>Sample Queries:</strong></p>
          <ul>
            <li><code>v</code> → ${queryCandidates(dayiMap, 'v').slice(0, 3).map(c => c.char).join(', ')}</li>
            <li><code>a</code> → ${queryCandidates(dayiMap, 'a').slice(0, 3).map(c => c.char).join(', ')}</li>
          </ul>
        `;
      }
    }, 1000);
  </script>
</body>
</html>
